# Commande de cuve à vagues NOVA Physics
# Gui pour commande d'un arduino
# fichier de définition d'UI

#:import __version__ main.__version__

BoxLayout:
    orientation: 'vertical'
    spacing: dp(10)
    padding: dp(20)
    BoxLayout:
        id : mode
        spacing: dp(20)
        orientation: 'horizontal'
        Label:
            text: 'Mode'
        Spinner:
            id: spinner_mode
            values: 'Continuous', 'Burst'
            text: self.values[0]
            on_text: app.set_mode(self.text == 'Burst')
    BoxLayout:
        id: freq
        spacing: dp(20)
        orientation: 'horizontal'
        Label:
            size_hint_x: None
            width: dp(150)
            text: 'Frequency (Hz)'
        Slider:
            id: slider_freq
            min: 0
            max: 5
            orientation: 'horizontal'
            on_value: app.reflect_val('slider', input_freq, slider_freq,0,5,3)
            on_touch_up: if args[1].grab_current == self: app.update_freq()
        TextInput:
            id: input_freq
            size_hint_y: None
            height: dp(50)
            size_hint_x: None
            multiline: False
            width: dp(150)
            text: '0.000'
            on_text_validate: app.reflect_val('input', input_freq, slider_freq, 0, 5, 3); app.update_freq()
    BoxLayout:
        id: pulse
        disabled: True
        spacing: dp(20)
        orientation: 'horizontal'
        Label:
            size_hint_x: None
            width: dp(150)
            text: 'Number of pulses'
        Slider:
            id: slider_pulses
            min: 1
            max: 10
            step: 1
            orientation: 'horizontal'
            on_value: app.reflect_val('slider', input_pulses, slider_pulses, 1, 10, 0)
        TextInput:
            id: input_pulses
            size_hint_y: None
            height: dp(50)
            size_hint_x: None
            multiline: False
            width: dp(150)
            text: '1'
            on_text_validate: app.reflect_val('input', input_pulses, slider_pulses, 1, 10, 0)
    BoxLayout:
        id: repeat_pulse
        disabled: True
        spacing: dp(20)
        orientation: 'horizontal'
        Label:
            text: 'Repeat Bursts'
            size_hint_x: None
            width: dp(100)
        Switch:
            id: checkbox_repeat_pulses
            size_hint_x: None
            width: dp(50)
            on_active: app.set_repeat(self.active)
        Label:
            id: every_repeat
            text: 'every'
            size_hint_x: None
            width: dp(80)
        Spinner:
            id: spinner_repeat_pulses
            values: '2s', '5s', '10s'
            text: self.values[0]
    # Label:  # placeholder only
    BoxLayout:
        spacing: dp(20)
        Button:
            text: 'Set'
            on_release : app.set_generator(spinner_mode.text, input_freq.text, input_pulses.text)
        Button:
            background_color: (1,0,0)
            text: 'Stop'
            on_release: app.stop_generator()
    Label:
        size_hint_y: None
        height: dp(20)
        font_size: sp(12)
        text: "Wavegen v" + __version__ + " - olivier boesch © 2020 - Lycée saint Exupéry (Marseille)"



# Popup shown when connection is impossible
<MessagePopup@Popup>
    title: 'Error'
    on_dismiss: app.stop()
    size_hint: 0.7,0.7
    BoxLayout:
        orientation: 'vertical'
        Label:
            text: 'Please connect the microcontroller to this device'
        Button:
            size_hint_y: 0.2
            text: 'Close'
            on_release: root.dismiss();
